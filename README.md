# Subscription Service

**Subscription Service** ‚Äî —ç—Ç–æ REST-—Å–µ—Ä–≤–∏—Å –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –æ–± –æ–Ω–ª–∞–π–Ω-–ø–æ–¥–ø–∏—Å–∫–∞—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ Go —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º best practices –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –æ–±–ª–∞—á–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- **CRUDL –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–¥ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏:**
  - `POST /api/v1/subscriptions` ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø–æ–¥–ø–∏—Å–∫–∏
  - `GET /api/v1/subscriptions/:id` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ ID
  - `PUT /api/v1/subscriptions/:id` ‚Äî –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
  - `DELETE /api/v1/subscriptions/:id` ‚Äî –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
  - `GET /api/v1/subscriptions` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞:**
  - `GET /api/v1/subscriptions/cost` ‚Äî –†–∞—Å—á–µ—Ç —Å—É–º–º–∞—Ä–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–¥–ø–∏—Å–æ–∫ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- **API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
  - `GET /swagger/index.html` ‚Äî –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger UI


## ‚ú® Best Practices

- **Clean Architecture:** –ü—Ä–æ–µ–∫—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –ø–æ —Å–ª–æ—è–º (models, repository, service), —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∏–∑–∫—É—é —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –∏ –≤—ã—Å–æ–∫—É—é —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å.
- **Dependency Injection (DI):** –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –ª–æ–≥–≥–µ—Ä) –∏–Ω–∂–µ–∫—Ç—è—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ unit-—Ç–µ—Å—Ç–∞—Ö.
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `config.yaml` –¥–ª—è –±–∞–∑–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è sensitive-–¥–∞–Ω–Ω—ã—Ö –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤ runtime.
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:**
  - **Multi-stage Dockerfile** –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ (~20 MB).
  - **–ó–∞–ø—É—Å–∫ –æ—Ç –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
  - **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–µ–≤** –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–±–æ—Ä–∫–∏.
- **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞–∫ –∫–æ–¥ (IaC):** –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `docker-compose`, –≤–∫–ª—é—á–∞—è –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–∞–º–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
- **–ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î:** –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î —á–µ—Ä–µ–∑ `goose`, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `zap` (JSON —Ñ–æ—Ä–º–∞—Ç).
- **Graceful Shutdown:** (–ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è) –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ —Å –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

## üõ†Ô∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è       | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è                                |
|-----------------|-------------------------------------------|
| **–Ø–∑—ã–∫**        | Go 1.25                                 |
| **–í–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫** | Echo v4                                   |
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**   | PostgreSQL 17                             |
| **–ë–î –¥—Ä–∞–π–≤–µ—Ä**    | pgx/v5                                    |
| **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**| Docker, Docker Compose                    |
| **–ú–∏–≥—Ä–∞—Ü–∏–∏**    | goose                                     |
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**  | viper                                     |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**   | zap                                       |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**  | swaggo/swag, echo-swagger                 |
| **UUID**        | google/uuid                               |
| **–í–∞–ª–∏–¥–∞—Ü–∏—è**   | go-playground/validator                   |

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker
- Docker Compose

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
   ```
   git clone https://github.com/your-username/subscription-service.git
   cd subscription-service
   ```

2. **–°–æ–∑–¥–∞–π—Ç–µ `.env` —Ñ–∞–π–ª:**
   –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
   ```
   cp .env.example .env
   ```
   *–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç–µ `HOST_PORT` –≤ `.env`, –µ—Å–ª–∏ –ø–æ—Ä—Ç `8081` –∑–∞–Ω—è—Ç.*

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:**
   –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–±–µ—Ä–µ—Ç –æ–±—Ä–∞–∑, –ø–æ–¥–Ω–∏–º–µ—Ç –ë–î, –ø—Ä–∏–º–µ–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.
   ```
   docker-compose up --build
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Å–µ—Ä–≤–∏—Å–∞:**
   - **API:** `http://localhost:8081/api/v1/subscriptions` (–∏–ª–∏ –ø–æ—Ä—Ç, —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ `HOST_PORT`)
   - **Swagger UI:** `http://localhost:8081/swagger/index.html`
   - **REST Client (VS Code):** –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `requests.http` –∏ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞–ø—Ä—è–º—É—é –∏–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

```
docker-compose down
```

## üë®‚Äçüíª –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ (–º–∏–Ω–∏–º—É–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.25
- PostgreSQL 17+
- goose

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```
   go mod download
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL** (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ Docker):
   ```
   docker run --name pg -e POSTGRES_PASSWORD=postgres -e POSTGRES_DB=subscription_db -p 5432:5432 -d postgres:17
   ```

3. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
   ```
   goose -dir migrations postgres "host=localhost port=5432 user=postgres password=postgres dbname=subscription_db sslmode=disable" up
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```
   go run cmd/app/main.go
   ```

## üì¶ –ö–æ–º–∞–Ω–¥—ã

- **–ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:** `docker-compose up --build`
- **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:** `docker-compose down -v`
- **–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:** `docker-compose logs -f app`
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è Swagger-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** `swag init -g cmd/app/main.go --parseDependency --parseInternal`
- **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏:** `goose -dir migrations create <migration_name> sql`
